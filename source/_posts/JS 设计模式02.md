---
title: JS 设计模式(二)
date: 2019-04-06
tags:
  - IT技术
  - 前端
  - Javascript
---

### 观察者模式
特点：
- 发布 & 订阅
- 一对多
```
class Subject{
    constructor(){
        this.state = 0;
        this.observers = [];
    }
    getState(){
        return this.state
    }
    setState(state){
        this.state = state
        this.notifyAllObservers();
    }
    notifyAllObservers(){
        this.observers.forEach(observer => {
            observer.update()
        })
    }
    attach(observer){
        this.observers.push(observer);
    }
}

class Observer{
    constructor(name, subject){
        this.name = name;
        this.subject = subject;
    }
    
    update(){
        console.log(`${this.name} is update, 值为${this.subject}`)
    }
}

const s = new Subject();
const o1 = new Observer('o1', s);
const o2 = new Observer('o2', s);
const o3 = new Observer('o3', s);

s.setState(1);
s.setState(2);
s.setState(3);

// 应用示例

// 1.网页事件绑定
<button id="btn1">点击</button>

<script>
    $('#btn1').click(function(){
        console.log('1')
    });
    $('#btn1').click(function(){
        console.log('2')
    });
    $('#btn1').click(function(){
        console.log('3')
    });                
</script>

// 2. Promise
const result = loadImg(); // 异步http调用
result.then( img => {
    console.log(img.width)
}).then( img => {
    console.log(img.height)
})

// 3. $.CallBacks

// 4. nodejs自定义事件
const EventEmitter = require('events').EventEmitter;

const emitter1 = new EventEmitter();
emitter1.on('some', info => {
    console.log('fn1', info);
})

emitter1.on('some', info => {
    console.log('fn2', info);
})

emitter1.emit('some', 'xxxxxx');

// fn1 xxxxxx
// fn2 xxxxxx
```

### 迭代器模式
特点：
- 顺序访问集合
- 使用者无需知道集合的内部结构
```
var arr = [1,2,3];
var nodeList = document.getElementByTagName('p');
var $p = $('p');

arr.forEach( item => {
    console.log(item);
})

var i,length = nodeList.length;
for ( i = 0; i < length; i++ ) {
    console.log(nodeList[i])
}

// 第三
$p.each( (key, p) => {
    console.log(key, p)
})

function each(data){
    const $el = $(data) // 生成迭代器
    $el.each( (key, p) => {
        console.log(key, p)
    })
}
```